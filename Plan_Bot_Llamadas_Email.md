# BRIEFING PROFESIONAL - BOT DE LLAMADAS Y EMAIL AUTOMATIZADO CON IA

## üìã √çNDICE
1. [Objetivo General](#objetivo-general)
2. [Funcionamiento Detallado](#funcionamiento-detallado)
3. [Infraestructura y Herramientas](#infraestructura-y-herramientas)
4. [Formulario de Configuraci√≥n](#formulario-de-configuraci√≥n)
5. [Gesti√≥n Autom√°tica de N√∫meros Twilio](#gesti√≥n-autom√°tica-de-n√∫meros-twilio)
6. [Redirecci√≥n de Llamadas](#redirecci√≥n-de-llamadas)
7. [Flujos de Automatizaci√≥n n8n](#flujos-de-automatizaci√≥n-n8n)
8. [Estructura del Backend](#estructura-del-backend)
9. [Base de Datos](#base-de-datos)
10. [P√°ginas Web Necesarias](#p√°ginas-web-necesarias)
11. [Cronograma 3 D√≠as](#cronograma-3-d√≠as)
12. [Checklist Final MVP](#checklist-final-mvp)

---

## üéØ OBJETIVO GENERAL

### Problema a Resolver
Las empresas necesitan atender llamadas y correos 24/7 pero no tienen recursos para contratar personal dedicado. Pierden clientes potenciales fuera del horario laboral y gastan tiempo en tareas repetitivas.

### Soluci√≥n Propuesta
Sistema SaaS que proporciona:
- **Bot de voz inteligente** para atender llamadas autom√°ticamente
- **Asistente de email** que lee y responde correos
- **Sistema de redirecci√≥n** que mantiene el n√∫mero original de la empresa
- **Panel de configuraci√≥n** simple y profesional
- **Reportes autom√°ticos** de actividad

### P√∫blico Objetivo
- Peque√±as y medianas empresas (PyMEs)
- Profesionales independientes (abogados, m√©dicos, consultores)
- Startups que necesitan presencia profesional
- Empresas de servicios con alta demanda telef√≥nica

### Propuesta de Valor
- **Sin cambio de n√∫mero**: El cliente mantiene su n√∫mero actual
- **Configuraci√≥n en 5 minutos**: Formulario web simple
- **Respuestas inteligentes**: IA entrenada para cada negocio
- **Multicanal**: Llamadas + emails en una sola plataforma
- **Reportes autom√°ticos**: Res√∫menes diarios por email

---

## FUNCIONAMIENTO DETALLADO

### Flujo Completo del Sistema

#### 1. Registro y Configuraci√≥n (Cliente)
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final
Cliente entra a la web ‚Üí Llena formulario ‚Üí Pago ‚Üí Configuraci√≥n autom√°tica
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

**Pasos detallados:**
1. Cliente visita landing page
2. Hace clic en "Empezar Ahora"
3. Completa formulario de configuraci√≥n:
   - Datos de la empresa
   - Tipo de negocio
   - Horarios de atenci√≥n
   - Mensajes personalizados
   - Email de contacto
4. Realiza pago (Stripe/PayPal)
5. Sistema autom√°ticamente:
   - Compra n√∫mero Twilio
   - Configura webhooks
   - Crea flujos n8n personalizados
   - Env√≠a instrucciones de redirecci√≥n

#### 2. Activaci√≥n del Bot (Autom√°tico)
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final
Pago confirmado ‚Üí N√∫mero Twilio asignado ‚Üí Webhooks configurados ‚Üí Bot activo
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

#### 3. Operaci√≥n Diaria (Autom√°tico)
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final
Llamada/Email recibido ‚Üí IA procesa ‚Üí Respuesta autom√°tica ‚Üí Reporte al cliente
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

### Arquitectura del Sistema

```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final
[Cliente] ‚Üí [N√∫mero Original] ‚Üí [Redirecci√≥n] ‚Üí [Twilio] ‚Üí [n8n] ‚Üí [IA] ‚Üí [Respuesta]
                                                     ‚Üì
[Email IMAP] ‚Üí [n8n] ‚Üí [IA] ‚Üí [Respuesta/Redirecci√≥n] ‚Üí [Cliente Final]
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

---

## INFRAESTRUCTURA Y HERRAMIENTAS

### Stack Tecnol√≥gico Principal

#### 1. **Twilio** (Llamadas y SMS)
- **Funci√≥n**: Manejo de llamadas telef√≥nicas
- **Servicios usados**:
  - Voice API (recibir/hacer llamadas)
  - Phone Numbers API (compra autom√°tica)
  - Webhooks (integraci√≥n con n8n)
- **Costo estimado**: $1/mes por n√∫mero + $0.0085/minuto
- **Alternativa gratuita**: FreeSWITCH (m√°s complejo de configurar)

#### 2. **n8n** (Automatizaci√≥n)
- **Funci√≥n**: Orquestador de flujos de trabajo
- **Servicios usados**:
  - Webhooks de Twilio
  - Conexiones IMAP/SMTP
  - Integraciones con APIs de IA
  - Cron jobs para tareas programadas
- **Hosting**: Render.com (plan gratuito disponible)
- **Alternativa**: Zapier (de pago) o Make.com

#### 3. **Render.com** (Backend y Hosting)
- **Funci√≥n**: Hosting del backend y n8n
- **Servicios usados**:
  - Web Services (API REST)
  - Background Workers (procesamiento)
  - PostgreSQL (base de datos)
  - Static Sites (frontend)
- **Costo**: Plan gratuito disponible, $7/mes para producci√≥n
- **Alternativa gratuita**: Railway, Fly.io

#### 4. **OpenAI Whisper** (Transcripci√≥n)
- **Funci√≥n**: Convertir audio a texto
- **Implementaci√≥n**: API de OpenAI o modelo local
- **Costo**: $0.006/minuto (API) o gratis (local)
- **Alternativa gratuita**: Whisper local con Hugging Face

#### 5. **ElevenLabs** (S√≠ntesis de Voz)
- **Funci√≥n**: Convertir texto a voz natural
- **Plan**: 10,000 caracteres gratis/mes
- **Costo**: $5/mes para 30,000 caracteres
- **Alternativa gratuita**: Google Text-to-Speech, Azure Speech

#### 6. **OpenAI GPT** (Inteligencia Artificial)
- **Funci√≥n**: Procesamiento de lenguaje natural
- **Modelos**: GPT-3.5-turbo (m√°s barato) o GPT-4
- **Costo**: $0.002/1K tokens (GPT-3.5)
- **Alternativa gratuita**: Ollama con Llama 2/3

### Herramientas de Desarrollo

#### Frontend
- **HTML/CSS/JavaScript**: P√°ginas web est√°ticas
- **Bootstrap 5**: Framework CSS responsivo
- **Stripe Elements**: Procesamiento de pagos

#### Backend
- **Node.js**: Runtime principal
- **Express.js**: Framework web
- **PostgreSQL**: Base de datos relacional
- **Prisma**: ORM para base de datos

#### Servicios Adicionales
- **IMAP/SMTP**: Manejo de emails (Gmail, Outlook)
- **Stripe**: Procesamiento de pagos
- **Cloudflare**: CDN y protecci√≥n DDoS
- **Let's Encrypt**: Certificados SSL gratuitos

### Arquitectura de Microservicios

```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Frontend      ‚îÇ    ‚îÇ   Backend API   ‚îÇ    ‚îÇ   n8n Workflows ‚îÇ
‚îÇ   (Static)      ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   (Express)     ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   (Automation)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ                        ‚îÇ
                              ‚ñº                        ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   PostgreSQL    ‚îÇ    ‚îÇ   External APIs ‚îÇ
                    ‚îÇ   (Database)    ‚îÇ    ‚îÇ   (Twilio, AI)  ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

---

## FORMULARIO DE CONFIGURACI√ìN

### Campos Obligatorios

#### 1. **Informaci√≥n de la Empresa**
```json
{
  "company_name": "Nombre de la empresa",
  "industry": "Sector/Industria (dropdown)",
  "contact_email": "Email principal de contacto",
  "phone_number": "N√∫mero actual de la empresa",
  "website": "Sitio web (opcional)",
  "address": "Direcci√≥n f√≠sica (opcional)"
}
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

#### 2. **Configuraci√≥n del Bot de Voz**
```json
{
  "bot_name": "Nombre del asistente (ej: Mar√≠a, Carlos)",
  "voice_gender": "G√©nero de voz (masculino/femenino)",
  "language": "Idioma principal (espa√±ol/ingl√©s)",
  "greeting_message": "Hola, soy Mar√≠a, asistente virtual de [Empresa]. ¬øEn qu√© puedo ayudarte hoy?",
  "information_gathering_prompts": [
    "¬øPodr√≠as decirme tu nombre completo?",
    "¬øCu√°l es tu n√∫mero de tel√©fono de contacto?",
    "¬øPodr√≠as explicarme brevemente el motivo de tu llamada?",
    "¬øHay algo m√°s que quieras a√±adir?"
  ],
  "business_hours": {
    "monday_friday": "09:00-18:00",
    "saturday": "09:00-14:00",
    "sunday": "cerrado"
  },
  "after_hours_message": "Gracias por llamar. Nuestro horario de atenci√≥n es de lunes a viernes de 9:00 a 18:00. Por favor, deja tu mensaje y te contactaremos pronto."
}
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

#### 3. **Configuraci√≥n de Email**
```json
{
  "email_address": "Email a monitorear",
  "email_password": "Contrase√±a de aplicaci√≥n",
  "imap_server": "imap.gmail.com (autodetectado)",
  "smtp_server": "smtp.gmail.com (autodetectado)",
  "email_forwarding_rules": [
    {
      "keywords": ["presupuesto", "cotizaci√≥n", "precio"],
      "forward_to": "ventas@empresa.com",
      "category": "Ventas"
    },
    {
      "keywords": ["soporte", "problema", "ayuda"],
      "forward_to": "soporte@empresa.com",
      "category": "Soporte T√©cnico"
    },
    {
      "keywords": ["cita", "reserva", "turno"],
      "forward_to": "citas@empresa.com",
      "category": "Citas"
    }
  ],
  "default_forward_to": "admin@empresa.com"
}
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

#### 4. **Informaci√≥n de la Empresa**
```json
{
  "company_description": "Breve descripci√≥n de la empresa (m√°x 200 caracteres)",
  "services_offered": ["Servicio 1", "Servicio 2", "Servicio 3"],
  "key_employees": [
    {
      "name": "Juan P√©rez",
      "position": "Gerente",
      "department": "Administraci√≥n"
    },
    {
      "name": "Mar√≠a Garc√≠a",
      "position": "Responsable de Ventas",
      "department": "Comercial"
    }
  ],
  "common_requests": [
    "Solicitar presupuesto",
    "Agendar cita",
    "Informaci√≥n sobre servicios",
    "Soporte t√©cnico"
  ]
}
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

#### 5. **Configuraci√≥n de Notificaciones y Redirecci√≥n**
```json
{
  "call_notifications": [
    {
      "type": "Solicitud de presupuesto",
      "notify_to": ["ventas@empresa.com", "gerente@empresa.com"],
      "priority": "alta",
      "include_recording": true
    },
    {
      "type": "Cita m√©dica",
      "notify_to": ["recepcion@clinica.com"],
      "priority": "media",
      "include_recording": false
    },
    {
      "type": "Soporte t√©cnico",
      "notify_to": ["soporte@empresa.com"],
      "priority": "alta",
      "include_recording": true
    }
  ],
  "daily_report_to": "admin@empresa.com",
  "report_time": "18:00",
  "urgent_contact": "+34600123456"
}
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

### Validaciones del Formulario

#### Frontend (JavaScript)
```javascript
const validateForm = {
  email: (email) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email),
  phone: (phone) => /^\+?[1-9]\d{1,14}$/.test(phone),
  required: (value) => value && value.trim().length > 0,
  businessHours: (hours) => /^\d{2}:\d{2}-\d{2}:\d{2}$/.test(hours)
};
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

#### Backend (Node.js)
```javascript
const joi = require('joi');

const configSchema = joi.object({
  company_name: joi.string().min(2).max(100).required(),
  contact_email: joi.string().email().required(),
  phone_number: joi.string().pattern(/^\+?[1-9]\d{1,14}$/).required(),
  bot_name: joi.string().min(2).max(50).required(),
  greeting_message: joi.string().max(500).required()
});
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

---

## GESTI√ìN AUTOM√ÅTICA DE N√öMEROS TWILIO

### Flujo de Compra Autom√°tica

#### 1. **Proceso Backend**
```javascript
// Funci√≥n para comprar n√∫mero autom√°ticamente
async function purchaseTwilioNumber(countryCode, areaCode = null) {
  try {
    // 1. Buscar n√∫meros disponibles
    const availableNumbers = await client.availablePhoneNumbers(countryCode)
      .local
      .list({
        areaCode: areaCode,
        limit: 10
      });
    
    if (availableNumbers.length === 0) {
      throw new Error('No hay n√∫meros disponibles');
    }
    
    // 2. Comprar el primer n√∫mero disponible
    const phoneNumber = availableNumbers[0].phoneNumber;
    const purchasedNumber = await client.incomingPhoneNumbers
      .create({
        phoneNumber: phoneNumber,
        voiceUrl: `${process.env.BASE_URL}/webhook/voice`,
        voiceMethod: 'POST',
        statusCallback: `${process.env.BASE_URL}/webhook/status`,
        statusCallbackMethod: 'POST'
      });
    
    return {
      success: true,
      phoneNumber: purchasedNumber.phoneNumber,
      sid: purchasedNumber.sid
    };
    
  } catch (error) {
    return {
      success: false,
      error: error.message
    };
  }
}
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

#### 2. **Configuraci√≥n de Webhooks**
```javascript
// Configurar webhooks autom√°ticamente
async function setupWebhooks(phoneNumberSid, clientId) {
  const webhookUrls = {
    voice: `${process.env.BASE_URL}/webhook/voice/${clientId}`,
    sms: `${process.env.BASE_URL}/webhook/sms/${clientId}`,
    status: `${process.env.BASE_URL}/webhook/status/${clientId}`
  };
  
  await client.incomingPhoneNumbers(phoneNumberSid)
    .update({
      voiceUrl: webhookUrls.voice,
      smsUrl: webhookUrls.sms,
      statusCallback: webhookUrls.status
    });
}
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

#### 3. **Gesti√≥n de Errores**
```javascript
const handleTwilioErrors = {
  20003: 'Permisos insuficientes - verificar API keys',
  20404: 'N√∫mero no encontrado',
  21211: 'N√∫mero no v√°lido',
  21212: 'N√∫mero no disponible para compra',
  21213: 'N√∫mero ya est√° en uso'
};

function handlePurchaseError(errorCode) {
  return handleTwilioErrors[errorCode] || 'Error desconocido al comprar n√∫mero';
}
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

### Base de Datos - Tabla Numbers
```sql
CREATE TABLE twilio_numbers (
  id SERIAL PRIMARY KEY,
  client_id INTEGER REFERENCES clients(id),
  phone_number VARCHAR(20) NOT NULL,
  twilio_sid VARCHAR(50) NOT NULL,
  country_code VARCHAR(5) DEFAULT 'ES',
  status VARCHAR(20) DEFAULT 'active',
  purchased_at TIMESTAMP DEFAULT NOW(),
  monthly_cost DECIMAL(10,2) DEFAULT 1.00,
  created_at TIMESTAMP DEFAULT NOW()
);
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

---

## REDIRECCI√ìN DE LLAMADAS

### Proceso para el Cliente

#### 1. **Instrucciones Autom√°ticas por Email**
Despu√©s de la compra, el sistema env√≠a autom√°ticamente:

```html
<!DOCTYPE html>
<html>
<head>
    <title>Configuraci√≥n de Redirecci√≥n - Bot IA</title>
</head>
<body>
    <h2>¬°Tu Bot IA est√° listo!</h2>
    
    <div class="info-box">
        <h3>Tu n√∫mero Twilio asignado:</h3>
        <p><strong>{{TWILIO_NUMBER}}</strong></p>
    </div>
    
    <h3>C√≥mo activar la redirecci√≥n:</h3>
    
    <div class="steps">
        <h4>Opci√≥n 1: Redirecci√≥n desde tu operador</h4>
        <ol>
            <li>Llama al servicio de atenci√≥n de tu operador</li>
            <li>Solicita "redirecci√≥n de llamadas" o "desv√≠o de llamadas"</li>
            <li>Proporciona este n√∫mero: <strong>{{TWILIO_NUMBER}}</strong></li>
            <li>Activa la redirecci√≥n para todas las llamadas</li>
        </ol>
        
        <h4>Opci√≥n 2: C√≥digos de redirecci√≥n</h4>
        <ul>
            <li><strong>Movistar:</strong> *21*{{TWILIO_NUMBER}}#</li>
            <li><strong>Vodafone:</strong> **21*{{TWILIO_NUMBER}}#</li>
            <li><strong>Orange:</strong> *21*{{TWILIO_NUMBER}}#</li>
            <li><strong>Yoigo:</strong> *21*{{TWILIO_NUMBER}}#</li>
        </ul>
        
        <h4>Opci√≥n 3: Redirecci√≥n condicional</h4>
        <ul>
            <li><strong>Si no contestas:</strong> **61*{{TWILIO_NUMBER}}#</li>
            <li><strong>Si est√° ocupado:</strong> **67*{{TWILIO_NUMBER}}#</li>
            <li><strong>Si no hay cobertura:</strong> **62*{{TWILIO_NUMBER}}#</li>
        </ul>
    </div>
    
    <div class="warning">
        <h4>Importante:</h4>
        <ul>
            <li>La redirecci√≥n puede tener costo seg√∫n tu operador</li>
            <li>Para desactivar, marca ##21#</li>
            <li>Prueba llamando a tu n√∫mero original</li>
        </ul>
    </div>
</body>
</html>
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

#### 2. **Verificaci√≥n Autom√°tica**
```javascript
// Verificar que la redirecci√≥n funciona
async function verifyRedirection(clientId, originalNumber, twilioNumber) {
  // Programar llamada de prueba en 10 minutos
  setTimeout(async () => {
    try {
      const call = await client.calls.create({
        to: originalNumber,
        from: twilioNumber,
        url: `${process.env.BASE_URL}/webhook/test-call/${clientId}`,
        method: 'POST'
      });
      
      // Guardar resultado de la prueba
      await saveTestResult(clientId, call.status);
      
    } catch (error) {
      await notifyRedirectionIssue(clientId, error.message);
    }
  }, 600000); // 10 minutos
}
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

### Soporte T√©cnico Automatizado

#### Email de Seguimiento (24h despu√©s)
```javascript
const followUpEmail = {
  subject: '¬øNecesitas ayuda con la redirecci√≥n?',
  template: `
    Hola {{COMPANY_NAME}},
    
    Hace 24 horas configuraste tu Bot IA. ¬øYa est√° funcionando correctamente?
    
    Si tienes problemas:
    ‚Ä¢ Responde este email con "AYUDA"
    ‚Ä¢ Ll√°manos al +34 900 123 456
    ‚Ä¢ Visita nuestro chat en vivo
    
    ¬°Estamos aqu√≠ para ayudarte!
  `
};
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

---

## FLUJOS DE AUTOMATIZACI√ìN N8N

### 1. Flujo de Llamadas Telef√≥nicas

#### Workflow: "Voice Call Handler"
```json
{
  "name": "Voice Call Handler",
  "nodes": [
    {
      "name": "Webhook Twilio",
      "type": "n8n-nodes-base.webhook",
      "parameters": {
        "path": "voice/{{clientId}}",
        "httpMethod": "POST"
      }
    },
    {
      "name": "Get Client Config",
      "type": "n8n-nodes-base.postgres",
      "parameters": {
        "query": "SELECT * FROM clients WHERE id = {{$json.clientId}}"
      }
    },
    {
      "name": "Check Business Hours",
      "type": "n8n-nodes-base.function",
      "parameters": {
        "functionCode": `
          const now = new Date();
          const hour = now.getHours();
          const day = now.getDay();
          
          const config = items[0].json;
          const businessHours = JSON.parse(config.business_hours);
          
          let isOpen = false;
          if (day >= 1 && day <= 5) { // Lunes a Viernes
            const [start, end] = businessHours.monday_friday.split('-');
            const startHour = parseInt(start.split(':')[0]);
            const endHour = parseInt(end.split(':')[0]);
            isOpen = hour >= startHour && hour < endHour;
          }
          
          return [{ json: { ...config, isOpen } }];
        `
      }
    },
    {
      "name": "Generate TwiML Response",
      "type": "n8n-nodes-base.function",
      "parameters": {
        "functionCode": `
          const config = items[0].json;
          const message = config.isOpen ? 
            config.greeting_message : 
            config.after_hours_message;
          
          const twiml = \`
            <?xml version="1.0" encoding="UTF-8"?>
            <Response>
              <Say voice="alice" language="es">${message}</Say>
              <Record 
                action="/webhook/recording/${config.id}"
                method="POST"
                maxLength="60"
                playBeep="true"
              />
            </Response>
          \`;
          
          return [{ json: { twiml } }];
        `
      }
    }
  ]
}
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

#### Workflow: "Recording Processor"
```json
{
  "name": "Recording Processor",
  "nodes": [
    {
      "name": "Webhook Recording",
      "type": "n8n-nodes-base.webhook",
      "parameters": {
        "path": "recording/{{clientId}}"
      }
    },
    {
      "name": "Download Audio",
      "type": "n8n-nodes-base.httpRequest",
      "parameters": {
        "url": "{{$json.RecordingUrl}}",
        "method": "GET",
        "responseFormat": "file"
      }
    },
    {
      "name": "Transcribe with Whisper",
      "type": "n8n-nodes-base.httpRequest",
      "parameters": {
        "url": "https://api.openai.com/v1/audio/transcriptions",
        "method": "POST",
        "headers": {
          "Authorization": "Bearer {{$env.OPENAI_API_KEY}}"
        },
        "body": {
          "model": "whisper-1",
          "file": "{{$binary.data}}"
        }
      }
    },
    {
      "name": "Process with GPT",
      "type": "n8n-nodes-base.openAi",
      "parameters": {
        "resource": "chat",
        "messages": [
          {
            "role": "system",
            "content": "Eres un asistente de {{$json.company_name}}. Analiza este mensaje y clasif√≠calo como: CITA, VENTA, SOPORTE, URGENTE, u OTRO."
          },
          {
            "role": "user",
            "content": "{{$json.text}}"
          }
        ]
      }
    },
    {
      "name": "Generate Response",
      "type": "n8n-nodes-base.function",
      "parameters": {
        "functionCode": `
          const classification = items[0].json.choices[0].message.content;
          const config = items[1].json; // Client config
          
          let response = "";
          
          switch(classification) {
            case "CITA":
              response = "Perfecto, te ayudo con tu cita. Te contactaremos en las pr√≥ximas 2 horas para confirmar disponibilidad.";
              break;
            case "VENTA":
              response = "Gracias por tu inter√©s. Un asesor comercial te llamar√° hoy mismo para darte toda la informaci√≥n.";
              break;
            case "URGENTE":
              response = "He registrado tu solicitud urgente. Te contactaremos inmediatamente.";
              break;
            default:
              response = "Gracias por contactarnos. Hemos recibido tu mensaje y te responderemos pronto.";
          }
          
          return [{ json: { response, classification } }];
        `
      }
    },
    {
      "name": "Text to Speech",
      "type": "n8n-nodes-base.httpRequest",
      "parameters": {
        "url": "https://api.elevenlabs.io/v1/text-to-speech/{{$env.ELEVENLABS_VOICE_ID}}",
        "method": "POST",
        "headers": {
          "xi-api-key": "{{$env.ELEVENLABS_API_KEY}}",
          "Content-Type": "application/json"
        },
        "body": {
          "text": "{{$json.response}}",
          "voice_settings": {
            "stability": 0.5,
            "similarity_boost": 0.5
          }
        }
      }
    },
    {
      "name": "Send Email Notification",
      "type": "n8n-nodes-base.emailSend",
      "parameters": {
        "to": "{{$json.notification_email}}",
        "subject": "Nueva llamada - {{$json.classification}}",
        "text": "Transcripci√≥n: {{$json.transcription}}\n\nClasificaci√≥n: {{$json.classification}}\n\nRespuesta enviada: {{$json.response}}"
      }
    }
  ]
}
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

### 2. Flujo de Emails

#### Workflow: "Email Monitor"
```json
{
  "name": "Email Monitor",
  "nodes": [
    {
      "name": "IMAP Trigger",
      "type": "n8n-nodes-base.emailReadImap",
      "parameters": {
        "host": "{{$json.imap_server}}",
        "port": 993,
        "secure": true,
        "user": "{{$json.email_address}}",
        "password": "{{$json.email_password}}",
        "folder": "INBOX",
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        }
      }
    },
    {
      "name": "Check if Auto-Reply Enabled",
      "type": "n8n-nodes-base.if",
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "{{$json.auto_reply_enabled}}",
              "value2": true
            }
          ]
        }
      }
    },
    {
      "name": "Analyze Email with GPT",
      "type": "n8n-nodes-base.openAi",
      "parameters": {
        "resource": "chat",
        "messages": [
          {
            "role": "system",
            "content": "Analiza este email y determina a qu√© departamento debe ser redirigido bas√°ndote en las palabras clave configuradas. Responde en formato JSON: {\"category\": \"categor√≠a detectada\", \"forward_to\": \"email de destino\", \"keywords_found\": [\"palabras clave encontradas\"], \"summary\": \"resumen del email\"}."
          },
          {
            "role": "user",
            "content": "{{$json.text}}"
          }
        ]
      }
    },
    {
      "name": "Generate Auto-Reply",
      "type": "n8n-nodes-base.openAi",
      "parameters": {
        "resource": "chat",
        "messages": [
          {
            "role": "system",
            "content": "Genera una respuesta profesional y √∫til para este email de {{$json.company_name}}"
          },
          {
            "role": "user",
            "content": "{{$json.text}}"
          }
        ]
      }
    },
    {
      "name": "Send Auto-Reply",
      "type": "n8n-nodes-base.emailSend",
      "parameters": {
        "to": "{{$json.from.address}}",
        "subject": "Re: {{$json.subject}}",
        "text": "{{$json.choices[0].message.content}}"
      }
    }
  ]
}
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

---

## üèóÔ∏è ESTRUCTURA DEL BACKEND

### Arquitectura de Carpetas

```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final
bot-ia-backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authController.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ clientController.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ twilioController.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ webhookController.js
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Client.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TwilioNumber.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CallLog.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ EmailLog.js
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ twilioService.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ openaiService.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ elevenlabsService.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ emailService.js
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validation.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rateLimiter.js
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ webhooks.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin.js
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logger.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ helpers.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ constants.js
‚îÇ   ‚îî‚îÄ‚îÄ config/
‚îÇ       ‚îú‚îÄ‚îÄ database.js
‚îÇ       ‚îú‚îÄ‚îÄ twilio.js
‚îÇ       ‚îî‚îÄ‚îÄ environment.js
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îî‚îÄ‚îÄ images/
‚îú‚îÄ‚îÄ views/
‚îÇ   ‚îú‚îÄ‚îÄ landing.html
‚îÇ   ‚îú‚îÄ‚îÄ signup.html
‚îÇ   ‚îî‚îÄ‚îÄ dashboard.html
‚îú‚îÄ‚îÄ tests/
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ .env.example
‚îî‚îÄ‚îÄ README.md
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

### Controladores Principales

#### 1. **clientController.js**
```javascript
const Client = require('../models/Client');
const twilioService = require('../services/twilioService');
const emailService = require('../services/emailService');

class ClientController {
  // Crear nuevo cliente
  async createClient(req, res) {
    try {
      const clientData = req.body;
      
      // Validar datos
      const validation = await this.validateClientData(clientData);
      if (!validation.isValid) {
        return res.status(400).json({ error: validation.errors });
      }
      
      // Crear cliente en BD
      const client = await Client.create(clientData);
      
      // Comprar n√∫mero Twilio
      const twilioNumber = await twilioService.purchaseNumber(
        clientData.country_code || 'ES'
      );
      
      if (!twilioNumber.success) {
        await Client.delete(client.id);
        return res.status(500).json({ error: 'Error al asignar n√∫mero' });
      }
      
      // Configurar webhooks
      await twilioService.setupWebhooks(twilioNumber.sid, client.id);
      
      // Enviar email de configuraci√≥n
      await emailService.sendSetupInstructions(client, twilioNumber.phoneNumber);
      
      res.json({
        success: true,
        client: client,
        twilioNumber: twilioNumber.phoneNumber
      });
      
    } catch (error) {
      console.error('Error creating client:', error);
      res.status(500).json({ error: 'Error interno del servidor' });
    }
  }
  
  // Obtener configuraci√≥n del cliente
  async getClientConfig(req, res) {
    try {
      const { clientId } = req.params;
      const client = await Client.findById(clientId);
      
      if (!client) {
        return res.status(404).json({ error: 'Cliente no encontrado' });
      }
      
      res.json(client);
    } catch (error) {
      res.status(500).json({ error: 'Error al obtener configuraci√≥n' });
    }
  }
  
  // Actualizar configuraci√≥n
  async updateClientConfig(req, res) {
    try {
      const { clientId } = req.params;
      const updates = req.body;
      
      const client = await Client.update(clientId, updates);
      
      // Actualizar flujos n8n si es necesario
      await this.updateN8nWorkflows(clientId, updates);
      
      res.json({ success: true, client });
    } catch (error) {
      res.status(500).json({ error: 'Error al actualizar configuraci√≥n' });
    }
  }
}

module.exports = new ClientController();
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

#### 2. **webhookController.js**
```javascript
const CallLog = require('../models/CallLog');
const EmailLog = require('../models/EmailLog');
const openaiService = require('../services/openaiService');

class WebhookController {
  // Webhook para llamadas de Twilio
  async handleVoiceCall(req, res) {
    try {
      const { clientId } = req.params;
      const { From, To, CallSid } = req.body;
      
      // Obtener configuraci√≥n del cliente
      const client = await Client.findById(clientId);
      if (!client) {
        return res.status(404).send('Cliente no encontrado');
      }
      
      // Verificar horario de atenci√≥n
      const isBusinessHours = this.checkBusinessHours(client.business_hours);
      
      // Generar respuesta TwiML
      const message = isBusinessHours ? 
        client.greeting_message : 
        client.after_hours_message;
      
      const twiml = `
        <?xml version="1.0" encoding="UTF-8"?>
        <Response>
          <Say voice="alice" language="es">${message}</Say>
          <Record 
            action="/webhook/recording/${clientId}"
            method="POST"
            maxLength="60"
            playBeep="true"
            transcribe="true"
          />
        </Response>
      `;
      
      // Registrar llamada
      await CallLog.create({
        client_id: clientId,
        call_sid: CallSid,
        from_number: From,
        to_number: To,
        status: 'in-progress',
        is_business_hours: isBusinessHours
      });
      
      res.type('text/xml').send(twiml);
      
    } catch (error) {
      console.error('Error handling voice call:', error);
      res.status(500).send('Error interno');
    }
  }
  
  // Webhook para grabaciones
  async handleRecording(req, res) {
    try {
      const { clientId } = req.params;
      const { RecordingUrl, CallSid, TranscriptionText } = req.body;
      
      // Actualizar log de llamada
      await CallLog.updateByCallSid(CallSid, {
        recording_url: RecordingUrl,
        transcription: TranscriptionText,
        status: 'completed'
      });
      
      // Procesar con IA si hay transcripci√≥n
      if (TranscriptionText) {
        await this.processCallWithAI(clientId, CallSid, TranscriptionText);
      }
      
      res.send('OK');
    } catch (error) {
      console.error('Error handling recording:', error);
      res.status(500).send('Error');
    }
  }
  
  // Procesar llamada con IA
  async processCallWithAI(clientId, callSid, transcription) {
    try {
      const client = await Client.findById(clientId);
      
      // Clasificar con GPT
      const classification = await openaiService.classifyMessage(
        transcription,
        client.company_name
      );
      
      // Generar respuesta
      const response = await openaiService.generateResponse(
        transcription,
        classification,
        client
      );
      
      // Actualizar log
      await CallLog.updateByCallSid(callSid, {
        ai_classification: classification,
        ai_response: response
      });
      
      // Enviar notificaci√≥n si es necesario
      if (classification === 'URGENTE') {
        await emailService.sendUrgentNotification(client, transcription);
      }
      
    } catch (error) {
      console.error('Error processing call with AI:', error);
    }
  }
}

module.exports = new WebhookController();
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

---

## üóÑÔ∏è BASE DE DATOS

### Esquema Completo PostgreSQL

#### 1. **Tabla Clients**
```sql
CREATE TABLE clients (
  id SERIAL PRIMARY KEY,
  company_name VARCHAR(100) NOT NULL,
  industry VARCHAR(50),
  contact_email VARCHAR(100) NOT NULL UNIQUE,
  phone_number VARCHAR(20) NOT NULL,
  website VARCHAR(200),
  address TEXT,
  
  -- Configuraci√≥n del bot
  bot_name VARCHAR(50) DEFAULT 'Asistente',
  voice_gender VARCHAR(10) DEFAULT 'female',
  language VARCHAR(5) DEFAULT 'es',
  greeting_message TEXT NOT NULL,
  after_hours_message TEXT,
  business_hours JSONB DEFAULT '{
    "monday_friday": "09:00-18:00",
    "saturday": "09:00-14:00",
    "sunday": "closed"
  }',
  
  -- Configuraci√≥n de email
  email_address VARCHAR(100),
  email_password VARCHAR(200), -- Encriptado
  imap_server VARCHAR(100) DEFAULT 'imap.gmail.com',
  smtp_server VARCHAR(100) DEFAULT 'smtp.gmail.com',
  email_forwarding_rules JSONB DEFAULT '[]',
  default_forward_to VARCHAR(100),
  
  -- Reglas de negocio
  keywords_appointment TEXT[] DEFAULT ARRAY['cita', 'reserva', 'turno'],
  keywords_sales TEXT[] DEFAULT ARRAY['precio', 'cotizaci√≥n', 'comprar'],
  keywords_support TEXT[] DEFAULT ARRAY['problema', 'ayuda', 'soporte'],
  forward_to_human TEXT[] DEFAULT ARRAY['hablar con persona', 'gerente'],
  emergency_keywords TEXT[] DEFAULT ARRAY['urgente', 'emergencia'],
  emergency_phone VARCHAR(20),
  
  -- Notificaciones
  notification_email VARCHAR(100) NOT NULL,
  daily_report BOOLEAN DEFAULT true,
  instant_alerts BOOLEAN DEFAULT true,
  report_time TIME DEFAULT '18:00:00',
  alert_keywords TEXT[] DEFAULT ARRAY['urgente', 'problema', 'queja'],
  
  -- Estado y fechas
  status VARCHAR(20) DEFAULT 'active',
  subscription_plan VARCHAR(20) DEFAULT 'basic',
  subscription_expires_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- √çndices para optimizaci√≥n
CREATE INDEX idx_clients_email ON clients(contact_email);
CREATE INDEX idx_clients_status ON clients(status);
CREATE INDEX idx_clients_subscription ON clients(subscription_expires_at);
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

#### 2. **Tabla Twilio Numbers**
```sql
CREATE TABLE twilio_numbers (
  id SERIAL PRIMARY KEY,
  client_id INTEGER REFERENCES clients(id) ON DELETE CASCADE,
  phone_number VARCHAR(20) NOT NULL UNIQUE,
  twilio_sid VARCHAR(50) NOT NULL UNIQUE,
  country_code VARCHAR(5) DEFAULT 'ES',
  area_code VARCHAR(10),
  capabilities JSONB DEFAULT '{
    "voice": true,
    "sms": true,
    "mms": false
  }',
  status VARCHAR(20) DEFAULT 'active',
  purchased_at TIMESTAMP DEFAULT NOW(),
  monthly_cost DECIMAL(10,2) DEFAULT 1.00,
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_twilio_numbers_client ON twilio_numbers(client_id);
CREATE INDEX idx_twilio_numbers_phone ON twilio_numbers(phone_number);
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

#### 3. **Tabla Call Logs**
```sql
CREATE TABLE call_logs (
  id SERIAL PRIMARY KEY,
  client_id INTEGER REFERENCES clients(id) ON DELETE CASCADE,
  call_sid VARCHAR(50) NOT NULL UNIQUE,
  from_number VARCHAR(20) NOT NULL,
  to_number VARCHAR(20) NOT NULL,
  direction VARCHAR(20) DEFAULT 'inbound',
  
  -- Detalles de la llamada
  duration INTEGER DEFAULT 0, -- en segundos
  status VARCHAR(20) DEFAULT 'initiated',
  start_time TIMESTAMP DEFAULT NOW(),
  end_time TIMESTAMP,
  
  -- Grabaci√≥n y transcripci√≥n
  recording_url TEXT,
  recording_duration INTEGER,
  transcription TEXT,
  transcription_confidence DECIMAL(3,2),
  
  -- Procesamiento IA
  ai_classification VARCHAR(50),
  ai_confidence DECIMAL(3,2),
  ai_response TEXT,
  ai_processed_at TIMESTAMP,
  
  -- Contexto
  is_business_hours BOOLEAN DEFAULT true,
  caller_location VARCHAR(100),
  user_agent TEXT,
  
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_call_logs_client ON call_logs(client_id);
CREATE INDEX idx_call_logs_date ON call_logs(start_time);
CREATE INDEX idx_call_logs_classification ON call_logs(ai_classification);
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

#### 4. **Tabla Email Logs**
```sql
CREATE TABLE email_logs (
  id SERIAL PRIMARY KEY,
  client_id INTEGER REFERENCES clients(id) ON DELETE CASCADE,
  message_id VARCHAR(200) NOT NULL,
  thread_id VARCHAR(200),
  
  -- Detalles del email
  from_address VARCHAR(200) NOT NULL,
  to_address VARCHAR(200) NOT NULL,
  cc_addresses TEXT[],
  bcc_addresses TEXT[],
  subject TEXT,
  body_text TEXT,
  body_html TEXT,
  
  -- Procesamiento
  direction VARCHAR(20) DEFAULT 'inbound', -- inbound/outbound
  ai_classification VARCHAR(50),
  ai_confidence DECIMAL(3,2),
  ai_response TEXT,
  auto_reply_sent BOOLEAN DEFAULT false,
  auto_reply_at TIMESTAMP,
  
  -- Archivos adjuntos
  has_attachments BOOLEAN DEFAULT false,
  attachment_count INTEGER DEFAULT 0,
  attachment_info JSONB,
  
  -- Fechas
  received_at TIMESTAMP DEFAULT NOW(),
  processed_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_email_logs_client ON email_logs(client_id);
CREATE INDEX idx_email_logs_date ON email_logs(received_at);
CREATE INDEX idx_email_logs_from ON email_logs(from_address);
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

#### 5. **Tabla Analytics**
```sql
CREATE TABLE analytics (
  id SERIAL PRIMARY KEY,
  client_id INTEGER REFERENCES clients(id) ON DELETE CASCADE,
  date DATE NOT NULL,
  
  -- M√©tricas de llamadas
  total_calls INTEGER DEFAULT 0,
  answered_calls INTEGER DEFAULT 0,
  missed_calls INTEGER DEFAULT 0,
  average_call_duration DECIMAL(10,2) DEFAULT 0,
  
  -- M√©tricas de emails
  total_emails INTEGER DEFAULT 0,
  auto_replied_emails INTEGER DEFAULT 0,
  forwarded_emails INTEGER DEFAULT 0,
  
  -- Clasificaciones IA
  appointments_requests INTEGER DEFAULT 0,
  sales_inquiries INTEGER DEFAULT 0,
  support_requests INTEGER DEFAULT 0,
  urgent_requests INTEGER DEFAULT 0,
  
  -- Costos
  twilio_cost DECIMAL(10,2) DEFAULT 0,
  openai_cost DECIMAL(10,2) DEFAULT 0,
  elevenlabs_cost DECIMAL(10,2) DEFAULT 0,
  
  created_at TIMESTAMP DEFAULT NOW(),
  
  UNIQUE(client_id, date)
);

CREATE INDEX idx_analytics_client_date ON analytics(client_id, date);
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

#### 6. **Tabla Notifications**
```sql
CREATE TABLE notifications (
  id SERIAL PRIMARY KEY,
  client_id INTEGER REFERENCES clients(id) ON DELETE CASCADE,
  type VARCHAR(50) NOT NULL, -- email, sms, webhook
  category VARCHAR(50) NOT NULL, -- urgent, daily_report, system
  
  -- Contenido
  title VARCHAR(200) NOT NULL,
  message TEXT NOT NULL,
  data JSONB,
  
  -- Estado
  status VARCHAR(20) DEFAULT 'pending', -- pending, sent, failed
  sent_at TIMESTAMP,
  error_message TEXT,
  retry_count INTEGER DEFAULT 0,
  
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_notifications_client ON notifications(client_id);
CREATE INDEX idx_notifications_status ON notifications(status);
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

### Funciones y Triggers

#### 1. **Trigger para updated_at**
```sql
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ language 'plpgsql';

CREATE TRIGGER update_clients_updated_at 
    BEFORE UPDATE ON clients 
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

#### 2. **Funci√≥n para generar analytics diarios**
```sql
CREATE OR REPLACE FUNCTION generate_daily_analytics(client_id_param INTEGER, date_param DATE)
RETURNS VOID AS $$
BEGIN
    INSERT INTO analytics (client_id, date, total_calls, total_emails, appointments_requests, sales_inquiries, support_requests, urgent_requests)
    SELECT 
        client_id_param,
        date_param,
        COALESCE(call_stats.total_calls, 0),
        COALESCE(email_stats.total_emails, 0),
        COALESCE(call_stats.appointments, 0),
        COALESCE(call_stats.sales, 0),
        COALESCE(call_stats.support, 0),
        COALESCE(call_stats.urgent, 0)
    FROM (
        SELECT 
            COUNT(*) as total_calls,
            COUNT(CASE WHEN ai_classification = 'CITA' THEN 1 END) as appointments,
            COUNT(CASE WHEN ai_classification = 'VENTA' THEN 1 END) as sales,
            COUNT(CASE WHEN ai_classification = 'SOPORTE' THEN 1 END) as support,
            COUNT(CASE WHEN ai_classification = 'URGENTE' THEN 1 END) as urgent
        FROM call_logs 
        WHERE client_id = client_id_param 
        AND DATE(start_time) = date_param
    ) call_stats
    FULL OUTER JOIN (
        SELECT COUNT(*) as total_emails
        FROM email_logs 
        WHERE client_id = client_id_param 
        AND DATE(received_at) = date_param
    ) email_stats ON true
    ON CONFLICT (client_id, date) 
    DO UPDATE SET
        total_calls = EXCLUDED.total_calls,
        total_emails = EXCLUDED.total_emails,
        appointments_requests = EXCLUDED.appointments_requests,
        sales_inquiries = EXCLUDED.sales_inquiries,
        support_requests = EXCLUDED.support_requests,
        urgent_requests = EXCLUDED.urgent_requests;
END;
$$ LANGUAGE plpgsql;
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final

---

## üåê P√ÅGINAS WEB NECESARIAS

### 1. Landing Page Principal

#### **index.html**
```html
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot IA - Asistente Virtual para tu Empresa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 100px 0;
        }
        .feature-card {
            transition: transform 0.3s;
            border: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .feature-card:hover {
            transform: translateY(-5px);
        }
        .pricing-card {
            border: 2px solid #e9ecef;
            transition: all 0.3s;
        }
        .pricing-card.featured {
            border-color: #667eea;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm fixed-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="#">
                <i class="fas fa-robot text-primary"></i> Bot IA
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="#features">Caracter√≠sticas</a></li>
                    <li class="nav-item"><a class="nav-link" href="#pricing">Precios</a></li>
                    <li class="nav-item"><a class="nav-link" href="#demo">Demo</a></li>
                    <li class="nav-item"><a class="btn btn-primary ms-2" href="#signup">Empezar Ahora</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section text-center">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <h1 class="display-4 fw-bold mb-4">
                        Tu Recepcionista Virtual <br>
                        <span class="text-warning">24/7</span>
                    </h1>
                    <p class="lead mb-4">
                        Nunca pierdas una llamada o email importante. Nuestro Bot IA atiende a tus clientes autom√°ticamente, mantiene tu n√∫mero original y te env√≠a reportes detallados.
                    </p>
                    <div class="d-flex gap-3 justify-content-center">
                        <a href="#signup" class="btn btn-warning btn-lg px-4">
                            <i class="fas fa-rocket"></i> Empezar Gratis
                        </a>
                        <a href="#demo" class="btn btn-outline-light btn-lg px-4">
                            <i class="fas fa-play"></i> Ver Demo
                        </a>
                    </div>
                </div>
                <div class="col-lg-6">
                    <img src="/images/hero-bot.png" alt="Bot IA" class="img-fluid">
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section id="features" class="py-5">
        <div class="container">
            <div class="text-center mb-5">
                <h2 class="display-5 fw-bold">¬øPor qu√© elegir Bot IA?</h2>
                <p class="lead text-muted">Automatiza tu atenci√≥n al cliente sin perder el toque humano</p>
            </div>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="card feature-card h-100 text-center p-4">
                        <div class="card-body">
                            <i class="fas fa-phone-alt fa-3x text-primary mb-3"></i>
                            <h5 class="card-title">Llamadas Inteligentes</h5>
                            <p class="card-text">Atiende llamadas autom√°ticamente, transcribe conversaciones y clasifica solicitudes por tipo.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card feature-card h-100 text-center p-4">
                        <div class="card-body">
                            <i class="fas fa-envelope fa-3x text-success mb-3"></i>
                            <h5 class="card-title">Emails Autom√°ticos</h5>
                            <p class="card-text">Lee y responde emails autom√°ticamente con respuestas personalizadas para tu negocio.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card feature-card h-100 text-center p-4">
                        <div class="card-body">
                            <i class="fas fa-chart-line fa-3x text-warning mb-3"></i>
                            <h5 class="card-title">Reportes Detallados</h5>
                            <p class="card-text">Recibe reportes diarios con estad√≠sticas y res√∫menes de toda la actividad.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Pricing Section -->
    <section id="pricing" class="py-5 bg-light">
        <div class="container">
            <div class="text-center mb-5">
                <h2 class="display-5 fw-bold">Planes Simples y Transparentes</h2>
                <p class="lead text-muted">Sin permanencia, cancela cuando quieras</p>
            </div>
            <div class="row justify-content-center">
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card pricing-card h-100">
                        <div class="card-body text-center p-4">
                            <h5 class="card-title">B√°sico</h5>
                            <div class="display-4 fw-bold text-primary mb-3">‚Ç¨29<small class="fs-6 text-muted">/mes</small></div>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success"></i> Hasta 100 llamadas/mes</li>
                                <li><i class="fas fa-check text-success"></i> Hasta 200 emails/mes</li>
                                <li><i class="fas fa-check text-success"></i> Reportes b√°sicos</li>
                                <li><i class="fas fa-check text-success"></i> Soporte por email</li>
                            </ul>
                            <a href="#signup" class="btn btn-outline-primary w-100">Empezar</a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card pricing-card featured h-100">
                        <div class="card-body text-center p-4">
                            <div class="badge bg-primary mb-2">M√°s Popular</div>
                            <h5 class="card-title">Profesional</h5>
                            <div class="display-4 fw-bold text-primary mb-3">‚Ç¨59<small class="fs-6 text-muted">/mes</small></div>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success"></i> Hasta 500 llamadas/mes</li>
                                <li><i class="fas fa-check text-success"></i> Hasta 1000 emails/mes</li>
                                <li><i class="fas fa-check text-success"></i> Reportes avanzados</li>
                                <li><i class="fas fa-check text-success"></i> Soporte prioritario</li>
                                <li><i class="fas fa-check text-success"></i> Integraciones</li>
                            </ul>
                            <a href="#signup" class="btn btn-primary w-100">Empezar</a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card pricing-card h-100">
                        <div class="card-body text-center p-4">
                            <h5 class="card-title">Empresa</h5>
                            <div class="display-4 fw-bold text-primary mb-3">‚Ç¨99<small class="fs-6 text-muted">/mes</small></div>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success"></i> Llamadas ilimitadas</li>
                                <li><i class="fas fa-check text-success"></i> Emails ilimitados</li>
                                <li><i class="fas fa-check text-success"></i> Analytics completos</li>
                                <li><i class="fas fa-check text-success"></i> Soporte 24/7</li>
                                <li><i class="fas fa-check text-success"></i> API personalizada</li>
                            </ul>
                            <a href="#signup" class="btn btn-outline-primary w-100">Contactar</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section id="signup" class="py-5 bg-primary text-white">
        <div class="container text-center">
            <h2 class="display-5 fw-bold mb-4">¬øListo para automatizar tu negocio?</h2>
            <p class="lead mb-4">Configura tu Bot IA en menos de 5 minutos</p>
            <a href="/signup.html" class="btn btn-warning btn-lg px-5">
                <i class="fas fa-rocket"></i> Empezar Ahora - Gratis
            </a>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5><i class="fas fa-robot"></i> Bot IA</h5>
                    <p>Automatiza tu atenci√≥n al cliente con inteligencia artificial.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p>&copy; 2024 Bot IA. Todos los derechos reservados.</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
```

---

## CRONOGRAMA DE DESARROLLO (3 D√çAS)

### D√≠a 1: Configuraci√≥n y Base
- Configuraci√≥n de repositorio y entorno
- Implementaci√≥n del backend b√°sico (Node.js/Express)
- Configuraci√≥n de base de datos PostgreSQL
- Integraci√≥n inicial con Twilio
- Frontend: Landing page

### D√≠a 2: Flujos de IA y Automatizaci√≥n
- Implementaci√≥n de flujos n8n para llamadas
- Implementaci√≥n de flujos n8n para emails
- Integraci√≥n con OpenAI (Whisper y GPT)
- Integraci√≥n con ElevenLabs
- Frontend: Formulario de configuraci√≥n

### D√≠a 3: Integraci√≥n y Despliegue
- Sistema de pagos (Stripe)
- Pruebas de integraci√≥n
- Optimizaci√≥n y correcci√≥n de errores
- Despliegue en producci√≥n (Render.com)
- Documentaci√≥n final
