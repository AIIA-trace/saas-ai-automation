<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üïê Debug Business Hours UI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .debug-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .log-output {
            background: #000;
            color: #0f0;
            font-family: monospace;
            padding: 10px;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
            font-size: 12px;
        }
        .test-result {
            padding: 8px;
            border-radius: 4px;
            margin: 5px 0;
        }
        .test-success { background: #d4edda; color: #155724; }
        .test-error { background: #f8d7da; color: #721c24; }
        .test-warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1>üïê Business Hours UI Debug Tool</h1>
        
        <div class="debug-section">
            <h3>üìã Test Controls</h3>
            <button id="test-dom-elements" class="btn btn-primary me-2">Test DOM Elements</button>
            <button id="test-localstorage" class="btn btn-info me-2">Test localStorage</button>
            <button id="test-setup-function" class="btn btn-warning me-2">Test Setup Function</button>
            <button id="simulate-data" class="btn btn-success me-2">Simulate Data Load</button>
            <button id="clear-logs" class="btn btn-secondary">Clear Logs</button>
        </div>

        <div class="debug-section">
            <h3>üéØ Business Hours UI (Minimal Test)</h3>
            <div class="row">
                <div class="col-md-6">
                    <h5>D√≠as de la semana:</h5>
                    <div class="form-check">
                        <input class="form-check-input business-day" type="checkbox" value="monday" id="monday">
                        <label class="form-check-label" for="monday">Lunes</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input business-day" type="checkbox" value="tuesday" id="tuesday">
                        <label class="form-check-label" for="tuesday">Martes</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input business-day" type="checkbox" value="wednesday" id="wednesday">
                        <label class="form-check-label" for="wednesday">Mi√©rcoles</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input business-day" type="checkbox" value="thursday" id="thursday">
                        <label class="form-check-label" for="thursday">Jueves</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input business-day" type="checkbox" value="friday" id="friday">
                        <label class="form-check-label" for="friday">Viernes</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input business-day" type="checkbox" value="saturday" id="saturday">
                        <label class="form-check-label" for="saturday">S√°bado</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input business-day" type="checkbox" value="sunday" id="sunday">
                        <label class="form-check-label" for="sunday">Domingo</label>
                    </div>
                </div>
                <div class="col-md-6">
                    <h5>Horarios:</h5>
                    <div class="mb-3">
                        <label for="business-hours-start" class="form-label">Hora de inicio:</label>
                        <select class="form-select" id="business-hours-start">
                            <option value="08:00">08:00</option>
                            <option value="09:00" selected>09:00</option>
                            <option value="10:00">10:00</option>
                            <option value="11:00">11:00</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="business-hours-end" class="form-label">Hora de fin:</label>
                        <select class="form-select" id="business-hours-end">
                            <option value="16:00">16:00</option>
                            <option value="17:00">17:00</option>
                            <option value="18:00" selected>18:00</option>
                            <option value="19:00">19:00</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Preview:</label>
                        <div id="business-hours-preview" class="badge bg-secondary">No configurado</div>
                    </div>
                    <input type="hidden" id="business_hours" name="business_hours" value="">
                </div>
            </div>
        </div>

        <div class="debug-section">
            <h3>üìä Test Results</h3>
            <div id="test-results"></div>
        </div>

        <div class="debug-section">
            <h3>üìù Console Logs</h3>
            <div id="log-output" class="log-output"></div>
        </div>
    </div>

    <script>
        // Capturar console.log para mostrar en la p√°gina
        const originalLog = console.log;
        const originalError = console.error;
        const logOutput = document.getElementById('log-output');
        
        function addToLog(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f00' : type === 'warn' ? '#ff0' : '#0f0';
            logOutput.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logOutput.scrollTop = logOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToLog(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToLog(args.join(' '), 'error');
        };

        // Funci√≥n de test para elementos DOM
        function testDOMElements() {
            console.log('üîç Testing DOM Elements...');
            const results = document.getElementById('test-results');
            let html = '<h5>DOM Elements Test:</h5>';
            
            const elements = [
                { id: 'business-day checkboxes', selector: '.business-day', expected: 7 },
                { id: 'business-hours-start', selector: '#business-hours-start', expected: 1 },
                { id: 'business-hours-end', selector: '#business-hours-end', expected: 1 },
                { id: 'business_hours input', selector: '#business_hours', expected: 1 },
                { id: 'business-hours-preview', selector: '#business-hours-preview', expected: 1 }
            ];
            
            elements.forEach(test => {
                const found = document.querySelectorAll(test.selector);
                const success = found.length === test.expected;
                const className = success ? 'test-success' : 'test-error';
                html += `<div class="${className}">
                    ${success ? '‚úÖ' : '‚ùå'} ${test.id}: Found ${found.length}, Expected ${test.expected}
                </div>`;
                console.log(`${success ? '‚úÖ' : '‚ùå'} ${test.id}: ${found.length}/${test.expected}`);
            });
            
            results.innerHTML = html;
        }

        // Funci√≥n de test para localStorage
        function testLocalStorage() {
            console.log('üíæ Testing localStorage...');
            const results = document.getElementById('test-results');
            let html = '<h5>localStorage Test:</h5>';
            
            const profileData = localStorage.getItem('profileData');
            if (profileData) {
                try {
                    const parsed = JSON.parse(profileData);
                    html += `<div class="test-success">‚úÖ profileData exists and is valid JSON</div>`;
                    html += `<div class="test-warning">üìã businessHours: ${parsed.businessHours || 'Not set'}</div>`;
                    console.log('‚úÖ profileData found:', parsed);
                } catch (e) {
                    html += `<div class="test-error">‚ùå profileData exists but is invalid JSON</div>`;
                    console.error('‚ùå profileData JSON error:', e);
                }
            } else {
                html += `<div class="test-warning">‚ö†Ô∏è No profileData in localStorage</div>`;
                console.log('‚ö†Ô∏è No profileData found');
            }
            
            results.innerHTML = html;
        }

        // Simular datos de prueba
        function simulateDataLoad() {
            console.log('üé≠ Simulating data load...');
            const testData = {
                businessHours: "Lun-Vie: 9:00-18:00",
                companyName: "Test Company",
                email: "test@test.com"
            };
            
            localStorage.setItem('profileData', JSON.stringify(testData));
            console.log('üíæ Test data saved to localStorage');
            
            // Simular carga de horario
            setTimeout(() => {
                console.log('‚è∞ Attempting to load business hours...');
                loadBusinessHoursFromData(testData.businessHours);
            }, 100);
        }

        // Funci√≥n simplificada de carga de horario comercial
        function loadBusinessHoursFromData(businessHoursText) {
            console.log('üïê loadBusinessHoursFromData called with:', businessHoursText);
            
            if (!businessHoursText) {
                console.log('‚ö†Ô∏è No business hours text provided');
                return;
            }
            
            // Parsear formato "Lun-Vie: 9:00-18:00"
            const match = businessHoursText.match(/^(.+):\s*(\d{1,2}:\d{2})-(\d{1,2}:\d{2})$/);
            if (!match) {
                console.error('‚ùå Invalid business hours format:', businessHoursText);
                return;
            }
            
            const [, daysText, startTime, endTime] = match;
            console.log('üìÖ Parsed - Days:', daysText, 'Start:', startTime, 'End:', endTime);
            
            // Mapeo de d√≠as
            const dayMap = {
                'Lun': 'monday', 'Mar': 'tuesday', 'Mi√©': 'wednesday',
                'Jue': 'thursday', 'Vie': 'friday', 'S√°b': 'saturday', 'Dom': 'sunday'
            };
            
            // Limpiar checkboxes
            document.querySelectorAll('.business-day').forEach(cb => cb.checked = false);
            
            // Procesar d√≠as
            if (daysText.includes('-')) {
                // Rango como "Lun-Vie"
                const [start, end] = daysText.split('-');
                const startDay = dayMap[start];
                const endDay = dayMap[end];
                console.log('üìÖ Range detected:', start, 'to', end);
                
                // Para simplificar, marcar Lun-Vie
                if (startDay === 'monday' && endDay === 'friday') {
                    ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'].forEach(day => {
                        const checkbox = document.getElementById(day);
                        if (checkbox) {
                            checkbox.checked = true;
                            console.log('‚úÖ Checked:', day);
                        }
                    });
                }
            }
            
            // Establecer horarios
            const startSelect = document.getElementById('business-hours-start');
            const endSelect = document.getElementById('business-hours-end');
            
            if (startSelect && startSelect.querySelector(`option[value="${startTime}"]`)) {
                startSelect.value = startTime;
                console.log('‚úÖ Start time set:', startTime);
            }
            
            if (endSelect && endSelect.querySelector(`option[value="${endTime}"]`)) {
                endSelect.value = endTime;
                console.log('‚úÖ End time set:', endTime);
            }
            
            // Actualizar preview
            updateBusinessHours();
        }

        // Funci√≥n simplificada de actualizaci√≥n
        function updateBusinessHours() {
            console.log('üîÑ updateBusinessHours called');
            
            const checkedDays = Array.from(document.querySelectorAll('.business-day:checked'))
                .map(cb => cb.nextElementSibling.textContent);
            
            const startTime = document.getElementById('business-hours-start').value;
            const endTime = document.getElementById('business-hours-end').value;
            
            let businessHoursText = '';
            if (checkedDays.length > 0) {
                businessHoursText = `${checkedDays.join(', ')}: ${startTime}-${endTime}`;
            }
            
            // Actualizar elementos
            const hiddenInput = document.getElementById('business_hours');
            const preview = document.getElementById('business-hours-preview');
            
            if (hiddenInput) hiddenInput.value = businessHoursText;
            if (preview) {
                preview.textContent = businessHoursText || 'No configurado';
                preview.className = businessHoursText ? 'badge bg-success' : 'badge bg-secondary';
            }
            
            console.log('üíæ Business hours updated:', businessHoursText);
        }

        // Funci√≥n de test para setup
        function testSetupFunction() {
            console.log('üîß Testing setup function...');
            
            // Verificar elementos
            const businessDays = document.querySelectorAll('.business-day');
            const startHourSelect = document.getElementById('business-hours-start');
            const endHourSelect = document.getElementById('business-hours-end');
            const businessHoursInput = document.getElementById('business_hours');
            const businessHoursPreview = document.getElementById('business-hours-preview');
            
            console.log('üìä Elements found:');
            console.log('  - Business days:', businessDays.length);
            console.log('  - Start select:', !!startHourSelect);
            console.log('  - End select:', !!endHourSelect);
            console.log('  - Hidden input:', !!businessHoursInput);
            console.log('  - Preview:', !!businessHoursPreview);
            
            if (businessDays.length === 0) {
                console.error('‚ùå No business day checkboxes found');
                return;
            }
            
            // Configurar event listeners
            businessDays.forEach(checkbox => {
                checkbox.addEventListener('change', updateBusinessHours);
            });
            
            if (startHourSelect) startHourSelect.addEventListener('change', updateBusinessHours);
            if (endHourSelect) endHourSelect.addEventListener('change', updateBusinessHours);
            
            console.log('üîó Event listeners configured');
            
            // Actualizar inicialmente
            updateBusinessHours();
            
            console.log('‚úÖ Setup completed successfully');
        }

        // Event listeners para botones
        document.getElementById('test-dom-elements').addEventListener('click', testDOMElements);
        document.getElementById('test-localstorage').addEventListener('click', testLocalStorage);
        document.getElementById('test-setup-function').addEventListener('click', testSetupFunction);
        document.getElementById('simulate-data').addEventListener('click', simulateDataLoad);
        document.getElementById('clear-logs').addEventListener('click', () => {
            logOutput.innerHTML = '';
            document.getElementById('test-results').innerHTML = '';
        });

        // Auto-ejecutar tests al cargar
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Business Hours Debug Tool loaded');
            console.log('üìã Available tests: DOM Elements, localStorage, Setup Function, Simulate Data');
            
            // Auto-test DOM elements
            setTimeout(() => {
                testDOMElements();
            }, 100);
        });
    </script>
</body>
</html>
