<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro - IA Receptionist</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-light">
    <!-- Header -->
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="index.html">
                    <i class="fas fa-robot me-2"></i>IA Receptionist
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="index.html">Inicio</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link btn btn-light text-primary ms-3" href="login.html">Iniciar sesión</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <!-- Registration Form -->
    <section class="py-5">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="card shadow-lg border-0 rounded-lg">
                        <div class="card-header bg-white text-center py-4">
                            <h2 class="mb-0">Crea tu cuenta</h2>
                            <p class="text-muted">Prueba gratuita por 14 días, sin tarjeta de crédito</p>
                        </div>
                        <div class="card-body p-4 p-md-5">
                            <form id="registrationForm">
                                <div class="row">
                                    <!-- Step 1: Account Information -->
                                    <div class="col-12" id="step1">
                                        <h4 class="mb-4">1. Información de la cuenta</h4>
                                        
                                        <div class="mb-3">
                                            <label for="email" class="form-label">Correo electrónico</label>
                                            <input type="email" class="form-control" id="email" required>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="password" class="form-label">Contraseña</label>
                                            <input type="password" class="form-control" id="password" 
                                                   minlength="8" required>
                                            <small class="text-muted">Mínimo 8 caracteres</small>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="confirmPassword" class="form-label">Confirmar contraseña</label>
                                            <input type="password" class="form-control" id="confirmPassword" 
                                                   minlength="8" required>
                                        </div>
                                        
                                        <div class="d-flex justify-content-end mt-4">
                                            <button type="button" class="btn btn-primary" id="step1Button">
                                                Continuar <i class="fas fa-arrow-right ms-2"></i>
                                            </button>
                                            <button type="button" class="btn btn-danger ms-2" onclick="document.getElementById('step1').classList.add('d-none'); document.getElementById('step2').classList.remove('d-none');">
                                                Debug: Ir al paso 2
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Step 2: Company Information -->
                                    <div class="col-12 d-none" id="step2">
                                        <h4 class="mb-4">2. Información de la empresa</h4>
                                        
                                        <div class="mb-3">
                                            <label for="companyName" class="form-label">Nombre de la empresa</label>
                                            <input type="text" class="form-control" id="companyName" required>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="companyDescription" class="form-label">Descripción (opcional)</label>
                                            <textarea class="form-control" id="companyDescription" rows="3"></textarea>
                                            <small class="text-muted">Breve descripción de tu empresa y servicios</small>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="contactPhone" class="form-label">Teléfono de contacto</label>
                                            <input type="tel" class="form-control" id="contactPhone">
                                        </div>
                                        
                                        <div class="d-flex justify-content-between mt-4">
                                            <button type="button" class="btn btn-outline-secondary" id="backToStep1Button">
                                                <i class="fas fa-arrow-left me-2"></i> Atrás
                                            </button>
                                            <button type="button" class="btn btn-primary" id="step2Button">
                                                Continuar <i class="fas fa-arrow-right ms-2"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Step 3: Select Plan -->
                                    <div class="col-12 d-none" id="step3">
                                        <h4 class="mb-4">3. Selecciona tu plan</h4>
                                        
                                        <div class="row mb-4">
                                            <div class="col-md-4 mb-3">
                                                <div class="card h-100 pricing-card border">
                                                    <div class="card-body">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio" name="plan" 
                                                                   id="basicPlan" value="basic" checked>
                                                            <label class="form-check-label w-100" for="basicPlan">
                                                                <h5>Básico</h5>
                                                                <h3 class="my-2">29€<span class="text-muted fs-6">/mes</span></h3>
                                                                <ul class="list-unstyled mt-3 small">
                                                                    <li>1 número telefónico</li>
                                                                    <li>1 cuenta de email</li>
                                                                    <li>100 minutos/mes</li>
                                                                </ul>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="col-md-4 mb-3">
                                                <div class="card h-100 pricing-card border pricing-popular">
                                                    <div class="card-body">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio" name="plan" 
                                                                   id="proPlan" value="professional">
                                                            <label class="form-check-label w-100" for="proPlan">
                                                                <h5>Profesional</h5>
                                                                <h3 class="my-2">79€<span class="text-muted fs-6">/mes</span></h3>
                                                                <ul class="list-unstyled mt-3 small">
                                                                    <li>3 números telefónicos</li>
                                                                    <li>3 cuentas de email</li>
                                                                    <li>500 minutos/mes</li>
                                                                </ul>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="col-md-4 mb-3">
                                                <div class="card h-100 pricing-card border">
                                                    <div class="card-body">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio" name="plan" 
                                                                   id="businessPlan" value="business">
                                                            <label class="form-check-label w-100" for="businessPlan">
                                                                <h5>Empresa</h5>
                                                                <h3 class="my-2">199€<span class="text-muted fs-6">/mes</span></h3>
                                                                <ul class="list-unstyled mt-3 small">
                                                                    <li>10 números telefónicos</li>
                                                                    <li>10 cuentas de email</li>
                                                                    <li>2000 minutos/mes</li>
                                                                </ul>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3 form-check">
                                            <input type="checkbox" class="form-check-input" id="termsCheck" required>
                                            <label class="form-check-label" for="termsCheck">
                                                Acepto los <a href="#">Términos y condiciones</a> y la <a href="#">Política de privacidad</a>
                                            </label>
                                        </div>
                                        
                                        <div class="d-flex justify-content-between mt-4">
                                            <button type="button" class="btn btn-outline-secondary" id="backToStep2Button">
                                                <i class="fas fa-arrow-left me-2"></i> Atrás
                                            </button>
                                            <button type="submit" class="btn btn-primary" id="registerButton">
                                                Crear cuenta <i class="fas fa-check ms-2"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer py-4 bg-dark text-white mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h3><i class="fas fa-robot me-2"></i>IA Receptionist</h3>
                    <p>Automatización inteligente de comunicaciones para empresas de todos los tamaños.</p>
                </div>
                <div class="col-md-3">
                    <h5>Enlaces</h5>
                    <ul class="list-unstyled">
                        <li><a href="index.html" class="text-white">Inicio</a></li>
                        <li><a href="login.html" class="text-white">Acceder</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h5>Contacto</h5>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-envelope me-2"></i> info@ia-receptionist.com</li>
                        <li><i class="fas fa-phone me-2"></i> +34 91 123 45 67</li>
                    </ul>
                </div>
            </div>
            <hr class="mt-4">
            <div class="text-center">
                <p class="mb-0">&copy; 2025 IA Receptionist. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    
    <!-- Configuración y servicios -->
    <script src="js/api-config.js"></script>
    <script src="js/auth-service.js"></script>
    
    <script>
        // Configuración de toastr
        toastr.options = {
            closeButton: true,
            progressBar: true,
            positionClass: "toast-top-right",
            timeOut: 5000
        };
        
        // Redireccionar si ya está autenticado
        if (authService.isAuthenticated()) {
            window.location.href = 'dashboard.html';
        }
        
        // Agregar event listeners para los botones y código de depuración
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM completamente cargado, configurando event listeners');
            
            // Verificar si los elementos existen
            const step1Button = document.getElementById('step1Button');
            const step2Button = document.getElementById('step2Button');
            const backToStep1Button = document.getElementById('backToStep1Button');
            const backToStep2Button = document.getElementById('backToStep2Button');
            
            console.log('Botones encontrados:', {
                step1Button: !!step1Button,
                step2Button: !!step2Button,
                backToStep1Button: !!backToStep1Button,
                backToStep2Button: !!backToStep2Button
            });
            
            // Botones de avance
            if (step1Button) {
                step1Button.addEventListener('click', function() {
                    console.log('Botón step1 clickeado');
                    nextStep(1, 2);
                });
            }
            
            if (step2Button) {
                step2Button.addEventListener('click', function() {
                    console.log('Botón step2 clickeado');
                    nextStep(2, 3);
                });
            }
            
            // Botones de retroceso
            if (backToStep1Button) {
                backToStep1Button.addEventListener('click', function() {
                    console.log('Botón backToStep1 clickeado');
                    prevStep(2, 1);
                });
            }
            
            if (backToStep2Button) {
                backToStep2Button.addEventListener('click', function() {
                    console.log('Botón backToStep2 clickeado');
                    prevStep(3, 2);
                });
            }
        });
        
        // Form navigation functions
        function nextStep(current, next) {
            // Basic validation for current step
            if (current === 1) {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                if (!email || !password || !confirmPassword) {
                    toastr.error('Completa todos los campos obligatorios', 'Validación');
                    return;
                }
                
                if (password !== confirmPassword) {
                    toastr.error('Las contraseñas no coinciden', 'Validación');
                    return;
                }
                
                if (password.length < 8) {
                    toastr.error('La contraseña debe tener al menos 8 caracteres', 'Validación');
                    return;
                }
            }
            
            if (current === 2) {
                const companyName = document.getElementById('companyName').value;
                
                if (!companyName) {
                    toastr.error('Ingresa el nombre de la empresa', 'Validación');
                    return;
                }
            }
            
            // Hide current step and show next step
            document.getElementById(`step${current}`).classList.add('d-none');
            document.getElementById(`step${next}`).classList.remove('d-none');
        }
        
        function prevStep(current, prev) {
            document.getElementById(`step${current}`).classList.add('d-none');
            document.getElementById(`step${prev}`).classList.remove('d-none');
        }
        
        // Form submission
        document.getElementById('registrationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Check terms acceptance
            if (!document.getElementById('termsCheck').checked) {
                toastr.error('Debes aceptar los términos y condiciones', 'Validación');
                return;
            }
            
            // Get form data
            const userData = {
                email: document.getElementById('email').value,
                password: document.getElementById('password').value,
                companyName: document.getElementById('companyName').value,
                companyDescription: document.getElementById('companyDescription').value,
                contactPhone: document.getElementById('contactPhone').value,
                plan: document.querySelector('input[name="plan"]:checked').value
            };
            
            // Deshabilitar botón y mostrar estado de carga
            const registerButton = document.getElementById('registerButton');
            registerButton.disabled = true;
            registerButton.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span> Registrando...';
            
            // Usar el servicio de autenticación
            authService.register(userData)
                .then(data => {
                    // Mostrar mensaje de éxito
                    toastr.success('Cuenta creada correctamente', '¡Bienvenido!');
                    
                    // Redireccionar al dashboard con un pequeño delay para mostrar el toast
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 1000);
                })
                .catch(error => {
                    console.error('Error:', error);
                    
                    // Mostrar mensaje de error
                    toastr.error(error.message || 'Error en el registro', 'Error');
                    
                    // Reset button
                    registerButton.disabled = false;
                    registerButton.innerHTML = 'Crear cuenta <i class="fas fa-user-plus ms-2"></i>';
                });
        });
    </script>
</body>
</html>
